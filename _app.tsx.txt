  const [loading, setLoading] = useState<boolean>(true)
  const [loggedIn, setLoggedIn] = useState<boolean>()

  useEffect(() => {
    (async () => {
      const res = await authorize();
      setLoggedIn(res);
      setLoading(false);
    })()
  }, []);

  if(loading)
    return (
      <View>
        <Text style={{
          color: COLORS.WHITE,
        }}>Loading...</Text>
      </View>
    )

  return (
    <>
      <NavigationContainer>
        <AppStack.Navigator screenOptions={{
          gestureEnabled: false,
          contentStyle: {
            backgroundColor: COLORS.BLACK
          },
          animation:'none',

          headerStyle: {
            backgroundColor: COLORS.BLACK,
          },
          headerTitleStyle: {
            color: COLORS.WHITE,
          },
          headerBackVisible: false,
        }}>
          {loggedIn == true ? (
            <>
              <AppStack.Screen name="Login" component={Login} />

              <AppStack.Screen name="Schools" component={Schools} options={{
                header: ({ navigation, route, options, back }) => Header({ navigation, route, options, back })
              }} />
            </>
          ) : (
            <>
              <AppStack.Screen name="Skema" component={Skema} options={{
                header: () => <></>
              }} />
    
              <AppStack.Screen name="Beskeder" component={BeskedNavigator} options={{
                header: () => <></>
              }} />
              <AppStack.Screen name="Lektier" component={Lektier} />
    
              <AppStack.Screen name="Mere" component={MereNavigator} options={{
                header: () => <></>
              }} />
            </>
          )}
        </AppStack.Navigator>
      </NavigationContainer>
    </>
  );
}

export function BeskedNavigator() {
  return (
    <Settings.Navigator initialRouteName="BeskedList" screenOptions={{
      gestureEnabled: true,
      headerStyle: {
        backgroundColor: COLORS.BLACK,
      },
      headerTitleStyle: {
        color: COLORS.WHITE,
      },
      headerBackTitleVisible: false,
      contentStyle: {backgroundColor: COLORS.BLACK},
    }}>
      <AppStack.Screen name={"BeskedList"} component={Beskeder} options={{ title: "Beskeder" }} />
      <AppStack.Screen name={"BeskedView"} component={BeskedView} options={{ title: "Besked" }} />
    </Settings.Navigator>
  )
}

export function MereNavigator() {
  return (
    <Settings.Navigator initialRouteName="Settings" screenOptions={{
      gestureEnabled: true,
      headerStyle: {
        backgroundColor: COLORS.BLACK,
      },
      headerTitleStyle: {
        color: COLORS.WHITE,
      },
      headerBackTitleVisible: false,
      contentStyle: {backgroundColor: COLORS.BLACK}
    }}>
      <AppStack.Screen name={"Settings"} component={Mere} />

      <Settings.Screen name={"Absence"} component={Absence} />
      <Settings.Screen name={"TruantOMeter"} component={TruantOMeter} />
      <Settings.Screen name={"TeachersAndStudents"} component={TeachersAndStudents} />
    </Settings.Navigator>
  )
}